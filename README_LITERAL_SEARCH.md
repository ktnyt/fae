# fae - ãƒªãƒ†ãƒ©ãƒ«æ¤œç´¢ JSON-RPC ã‚µãƒ¼ãƒãƒ¼

faeã¯JSON-RPCãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ç”¨ã—ãŸãƒªãƒ†ãƒ©ãƒ«æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚ripgrepã‚’ä½¿ç”¨ã—ã¦é«˜é€Ÿãªãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ã‚’æä¾›ã—ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ä¸€éƒ¨ã¨ã—ã¦å‹•ä½œã™ã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸš€ æ©Ÿèƒ½

- **JSON-RPC 2.0æº–æ‹ **: LSPã‚¹ã‚¿ã‚¤ãƒ«ã®Content-Lengthãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°
- **ripgrepçµ±åˆ**: é«˜é€Ÿãªãƒªãƒ†ãƒ©ãƒ«æ¤œç´¢
- **éåŒæœŸå‡¦ç†**: tokioãƒ™ãƒ¼ã‚¹ã®ä¸¦è¡Œå‡¦ç†
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµæœé…ä¿¡**: æ¤œç´¢çµæœã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§é€ä¿¡

## ğŸ“‹ JSON-RPC APIä»•æ§˜

### é€šçŸ¥ (Notifications)

#### `updateQuery`
æ¤œç´¢ã‚’é–‹å§‹ã—ã¾ã™ã€‚

```json
{
  "jsonrpc": "2.0",
  "method": "updateQuery",
  "params": {
    "query": "search_term"
  }
}
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `query` (string): æ¤œç´¢ã™ã‚‹ãƒªãƒ†ãƒ©ãƒ«æ–‡å­—åˆ—

**å‹•ä½œ:**
1. `clearSearchResults` é€šçŸ¥ã‚’é€ä¿¡
2. ripgrepã§æ¤œç´¢å®Ÿè¡Œé–‹å§‹
3. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: ripgrepãŒ1è¡Œå‡ºåŠ›ã™ã‚‹ãŸã³ã« `pushSearchResult` é€šçŸ¥ã‚’å³åº§ã«é€ä¿¡
4. å…¨ã¦ã®å‡ºåŠ›å‡¦ç†å®Œäº†å¾Œã« `searchCompleted` é€šçŸ¥ã‚’é€ä¿¡

#### ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®é€šçŸ¥

#### `clearSearchResults`
æ¤œç´¢çµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚

```json
{
  "jsonrpc": "2.0",
  "method": "clearSearchResults"
}
```

#### `pushSearchResult`
æ¤œç´¢çµæœã‚’1ä»¶é€ä¿¡ã—ã¾ã™ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰ã€‚

```json
{
  "jsonrpc": "2.0",
  "method": "pushSearchResult",
  "params": {
    "filename": "src/main.rs",
    "line": 42,
    "offset": 1250,
    "content": "    println!(\"Hello world\");"
  }
}
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `filename` (string): ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
- `line` (number): è¡Œç•ªå·
- `offset` (number): ãƒã‚¤ãƒˆã‚ªãƒ•ã‚»ãƒƒãƒˆ
- `content` (string): ãƒãƒƒãƒã—ãŸè¡Œã®å†…å®¹

**ç‰¹å¾´:**
- ripgrepãŒ1è¡Œå‡ºåŠ›ã™ã‚‹ãŸã³ã«å³åº§ã«é€ä¿¡
- ãƒ—ãƒ­ã‚»ã‚¹ã®çµ‚äº†ã‚’å¾…ãŸãšã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡
- å¤§é‡çµæœæ™‚ã¯100ä»¶ã”ã¨ã«yieldï¼ˆå¿œç­”æ€§ç¢ºä¿ï¼‰

#### `searchCompleted`
æ¤œç´¢ãŒå®Œäº†ã—ãŸã“ã¨ã‚’é€šçŸ¥ã—ã¾ã™ã€‚

```json
{
  "jsonrpc": "2.0",
  "method": "searchCompleted",
  "params": {
    "query": "search_term",
    "total_results": 42
  }
}
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `query` (string): å®Ÿè¡Œã•ã‚ŒãŸæ¤œç´¢ã‚¯ã‚¨ãƒª
- `total_results` (number): è¦‹ã¤ã‹ã£ãŸçµæœã®ç·æ•°

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (Requests)

#### `search.status`
ã‚µãƒ¼ãƒãƒ¼ã®çŠ¶æ…‹ã‚’å–å¾—ã—ã¾ã™ã€‚

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "search.status"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "status": "ready",
    "current_query": "search_term",
    "search_root": "/path/to/search"
  }
}
```

## ğŸ›  ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦ãªä¾å­˜é–¢ä¿‚

1. **Rust**: 1.70ä»¥ä¸Š
2. **ripgrep**: ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿

```bash
# Ubuntuã®å ´åˆ
sudo apt install ripgrep

# macOSã®å ´åˆ  
brew install ripgrep

# Windowsã®å ´åˆ
choco install ripgrep
```

### ãƒ“ãƒ«ãƒ‰ã¨å®Ÿè¡Œ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰
cargo build --release

# åˆ©ç”¨å¯èƒ½ãªã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§ã‚’è¡¨ç¤º
cargo run --bin fae-service list

# ãƒªãƒ†ãƒ©ãƒ«æ¤œç´¢ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§æ¤œç´¢ï¼‰
cargo run --bin fae-service start search:literal

# ç‰¹å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§æ¤œç´¢
cargo run --bin fae-service --root /path/to/search start search:literal

# ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®š
cargo run --bin fae-service --log-level debug start search:literal
```

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```
fae-service [OPTIONS] [COMMAND]

COMMANDS:
    start    ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•
    list     åˆ©ç”¨å¯èƒ½ãªã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§ã‚’è¡¨ç¤º
    help     ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º

OPTIONS:
    -r, --root <ROOT>           æ¤œç´¢å¯¾è±¡ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª [default: .]
    -l, --log-level <LEVEL>     ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« [default: info]
        --ripgrep-path <PATH>   ripgrepãƒã‚¤ãƒŠãƒªã®ãƒ‘ã‚¹
    -h, --help                  ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
    -V, --version               ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¡¨ç¤º

EXAMPLES:
    fae-service start search:literal           # ãƒªãƒ†ãƒ©ãƒ«æ¤œç´¢ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
    fae-service list                          # ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§è¡¨ç¤º
    fae-service --root /path start search:literal  # æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§èµ·å‹•
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
cargo test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
cargo test literal_search

# ripgrepã‚’ä½¿ã†ãƒ†ã‚¹ãƒˆã‚‚å«ã‚ã‚‹ï¼ˆripgrepãŒå¿…è¦ï¼‰
cargo test -- --ignored
```

## ğŸ“– ä½¿ç”¨ä¾‹

### Pythonã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

```python
#!/usr/bin/env python3
import json
import subprocess

# ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
process = subprocess.Popen(
    ["cargo", "run"],
    stdin=subprocess.PIPE,
    stdout=subprocess.PIPE,
    text=True
)

# updateQueryé€šçŸ¥ã‚’é€ä¿¡
message = {
    "jsonrpc": "2.0",
    "method": "updateQuery",
    "params": {"query": "function"}
}

json_str = json.dumps(message)
content_length = len(json_str)
full_message = f"Content-Length: {content_length}\r\n\r\n{json_str}"

process.stdin.write(full_message)
process.stdin.flush()

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’èª­ã¿å–ã‚Šï¼ˆçœç•¥ï¼‰
```

### ä»˜å±ã®ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

```bash
# Pythonãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å®Ÿè¡Œ
python3 examples/test_client.py "function"

# ç‰¹å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§æ¤œç´¢
cargo run --bin fae-service --root /path/to/project start search:literal &
python3 examples/test_client.py "TODO"
```

## ğŸ— ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   JSON-RPC Client   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ stdin/stdout
           â”‚ (LSP-style framing)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ JsonRpcStdioAdapter â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   JsonRpcEngine     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LiteralSearchHandlerâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ripgrep        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸»è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

- **`jsonrpc`**: JSON-RPC 2.0ãƒ—ãƒ­ãƒˆã‚³ãƒ«å®Ÿè£…
  - `engine.rs`: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³
  - `stdio.rs`: stdin/stdouté€šä¿¡ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
  - `message.rs`: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ§‹é€ ä½“ã¨ã‚¨ãƒ©ãƒ¼å‡¦ç†
  - `handler.rs`: ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒˆãƒ¬ã‚¤ãƒˆå®šç¾©

- **`services`**: å„ç¨®æ¤œç´¢ã‚µãƒ¼ãƒ“ã‚¹
  - `literal_search`: ãƒªãƒ†ãƒ©ãƒ«æ¤œç´¢ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
    - ripgrepçµ±åˆ
    - éåŒæœŸæ¤œç´¢å‡¦ç†  
    - çµæœã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
  - å°†æ¥è¿½åŠ äºˆå®š: symbol_search, file_search, regex_searchç­‰

## ğŸ”§ é–‹ç™º

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
src/
â”œâ”€â”€ main.rs              # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ lib.rs               # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ services/            # å„ç¨®æ¤œç´¢ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ mod.rs           # ã‚µãƒ¼ãƒ“ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šç¾©
â”‚   â””â”€â”€ literal_search.rs # ãƒªãƒ†ãƒ©ãƒ«æ¤œç´¢ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â””â”€â”€ jsonrpc/             # JSON-RPCå®Ÿè£…
    â”œâ”€â”€ mod.rs
    â”œâ”€â”€ engine.rs        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³
    â”œâ”€â”€ handler.rs       # ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒˆãƒ¬ã‚¤ãƒˆ
    â”œâ”€â”€ message.rs       # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ§‹é€ ä½“
    â””â”€â”€ stdio.rs         # stdin/stdoutçµ±åˆ

examples/
â””â”€â”€ test_client.py       # Pythonãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

tests/
â””â”€â”€ integration_tests.rs # çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆä»Šå¾Œè¿½åŠ äºˆå®šï¼‰
```

### æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

1. **æ–°ã—ã„æ¤œç´¢ã‚µãƒ¼ãƒ“ã‚¹**: `services/`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§`JsonRpcHandler`ãƒˆãƒ¬ã‚¤ãƒˆã‚’å®Ÿè£…
2. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å¤‰æ›´**: `ripgrep`ã®ä»£ã‚ã‚Šã«ä»–ã®æ¤œç´¢ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨
3. **é€šçŸ¥æ‹¡å¼µ**: æ¤œç´¢é€²æ—ã‚„ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã®è¿½åŠ 
4. **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã‚„é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¿½åŠ 

å°†æ¥ã®æ¤œç´¢ã‚µãƒ¼ãƒ“ã‚¹ä¾‹ï¼š
- `symbol_search`: Tree-sitterãƒ™ãƒ¼ã‚¹ã®ã‚·ãƒ³ãƒœãƒ«æ¤œç´¢
- `file_search`: ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»ãƒ‘ã‚¹æ¤œç´¢
- `regex_search`: æ­£è¦è¡¨ç¾æ¤œç´¢
- `git_search`: Gitå±¥æ­´çµ±åˆæ¤œç´¢

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ¤ è²¢çŒ®

1. Issueã‚’ä½œæˆã—ã¦å•é¡Œã‚„ææ¡ˆã‚’å ±å‘Š
2. ãƒ•ã‚©ãƒ¼ã‚¯ã—ã¦featureãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
3. ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ãƒ»å®Ÿè¡Œ
4. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

- GitHub Issues: ãƒã‚°å ±å‘Šã‚„æ©Ÿèƒ½ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: [docs/](docs/) ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- ã‚µãƒ³ãƒ—ãƒ«: [examples/](examples/) ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª